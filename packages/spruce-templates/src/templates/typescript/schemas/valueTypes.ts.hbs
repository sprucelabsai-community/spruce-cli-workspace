import { FieldDefinition } from '#spruce/schemas/fields/fields.types'
import FieldType from '#spruce/schemas/fields/fieldTypeEnum'
import fieldClassMap from '#spruce/schemas/fields/fieldClassMap'
import { TemplateRenderAs, IFieldTemplateDetailOptions } from '@sprucelabs/schema'


{{#each imports}}
// @ts-ignore
import * as {{importAs}} from '{{package}}'
{{/each}}

const schemaTemplateItems = {{{json schemaTemplateItems}}}

const generateTypeLiteral = (definition: FieldDefinition, renderAs: TemplateRenderAs, importAs: string) => {
	const options:SpruceSchema.IFieldTemplateDetailOptions<FieldDefinition> = {
		language: 'ts',
		// @ts-ignore
		templateItems: schemaTemplateItems,
		globalNamespace: '{{globalNamespace}}',
		definition,
		importAs,
		renderAs
	}

	const FieldClass = fieldClassMap[definition.type as FieldType]
	const details = FieldClass.generateTemplateDetails(
		options as IFieldTemplateDetailOptions<any>
	)
	
	return details.valueType
}


const valueTypes = {
	{{#each schemaTemplatesByNamespaceAndName}}
	"{{@key}}": {
		{{#each this}}
		"{{@key}}": {
			{{#each this}} 
			"{{schema.version}}{{#unless schema.version}}{{../../../SCHEMA_VERSION_FALLBACK}}{{/unless}}":{
				{{#if schema.dynamicFieldSignature}}
				__dynamicFieldSignature: {
					valueTypes: {
						{{#each ../../../rendersAs}}
						{{this}}: {{{ valueTypeGenerator ../schema.dynamicFieldSignature this 'generateTypeLiteral'}}},
						{{/each}}
					}
				},	
				{{/if}}
				{{#each schema.fields}}
				"{{@key}}": {
					valueTypes: {
						{{#each ../../../../rendersAs}}
						{{this}}: {{{ valueTypeGenerator ../this this 'generateTypeLiteral'}}},
						{{/each}}
					}
				},
				{{/each}}
			},
			{{/each}}
		},
		{{/each}}
	},
	{{/each}}
}

export default valueTypes
